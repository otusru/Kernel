# üõ†Ô∏è –ú–û–î–£–õ–¨ 6: –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–¥—Ä–∞ –û–° ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞

---

## üéØ –¶–µ–ª—å –º–æ–¥—É–ª—è:

* –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —è–¥—Ä–æ —Å –Ω—É–ª—è;
* –ü–æ–Ω—è—Ç—å, –∫–∞–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —è–¥—Ä–æ –∏ –∫–∞–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å "–∂–µ–ª–µ–∑–æ–º";
* –û—Å–≤–æ–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å GRUB, multiboot –∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –∫–æ–¥–∞;
* –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–æ–¥—É–ª—å–Ω–æ–≥–æ —è–¥—Ä–∞.

---

## üöÄ –ß—Ç–æ —Ç–∞–∫–æ–µ "—Å–≤–æ–µ —è–¥—Ä–æ"?

–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ —è–¥—Ä–æ ‚Äî —ç—Ç–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è:

* –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è BIOS/UEFI ‚Üí —á–µ—Ä–µ–∑ GRUB ‚Üí –≤ –ø–∞–º—è—Ç—å;
* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç–∫—Ä–∞–Ω, –ø–∞–º—è—Ç—å, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞;
* –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∏ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É;
* –ú–æ–∂–µ—Ç –±—ã—Ç—å **–º–æ–Ω–æ–ª–∏—Ç–Ω—ã–º**, **–º–æ–¥—É–ª—å–Ω—ã–º**, **–º–∏–∫—Ä–æ—è–¥–µ—Ä–Ω—ã–º** (–ø–æ —Ç–≤–æ–µ–º—É –≤—ã–±–æ—Ä—É).

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–≤–æ–µ–π –û–°

```text
mykernel/
‚îú‚îÄ‚îÄ boot/             ‚Üê –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π –∫–æ–¥ GRUB
‚îÇ   ‚îî‚îÄ‚îÄ grub.cfg
‚îú‚îÄ‚îÄ kernel/           ‚Üê –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ —è–¥—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ main.c
‚îÇ   ‚îú‚îÄ‚îÄ screen.c
‚îÇ   ‚îú‚îÄ‚îÄ memory.c
‚îÇ   ‚îî‚îÄ‚îÄ modules/      ‚Üê –ü–æ–¥–∫–ª—é—á–∞–µ–º—ã–µ –º–æ–¥—É–ª–∏
‚îú‚îÄ‚îÄ lib/              ‚Üê –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏: —Å—Ç—Ä–æ–∫–æ–≤—ã–µ, –ø–∞–º—è—Ç—å, –æ—Ç–ª–∞–¥–∫–∞
‚îú‚îÄ‚îÄ include/          ‚Üê –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ Makefile          ‚Üê –°–±–æ—Ä–∫–∞ —è–¥—Ä–∞
‚îî‚îÄ‚îÄ myos.iso          ‚Üê ISO-–æ–±—Ä–∞–∑ –¥–ª—è QEMU
```

---

## üìÅ –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç —è–¥—Ä–∞

### 1. üé¨ –ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞: `main.c`

```c
#include "screen.h"

void kernel_main(void) {
    clear_screen();
    print("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MyOS Kernel!\n");
}
```

---

### 2. üíª –í—ã–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞: `screen.c`

```c
#include <stdint.h>
#include "screen.h"

#define VIDEO_MEMORY (uint16_t*)0xb8000

void print(const char *msg) {
    uint16_t *video = VIDEO_MEMORY;
    while (*msg) {
        *video++ = (*msg++ | 0x0700); // —Å–∏–º–≤–æ–ª + —Ü–≤–µ—Ç
    }
}

void clear_screen() {
    for (int i = 0; i < 80 * 25; i++) {
        VIDEO_MEMORY[i] = 0x0720; // –ø—Ä–æ–±–µ–ª
    }
}
```

---

### 3. üß† –ó–∞–≥—Ä—É–∑—á–∏–∫ GRUB (Multiboot)

#### `grub.cfg`

```cfg
set timeout=0
set default=0

menuentry "My OS" {
    multiboot /boot/kernel.bin
    boot
}
```

---

### 4. üß± Makefile + –∫–æ–º–ø–∏–ª—è—Ü–∏—è

```makefile
ISO=myos.iso

all: kernel.bin
	mkdir -p isodir/boot/grub
	cp kernel.bin isodir/boot/
	cp grub.cfg isodir/boot/grub/
	grub-mkrescue -o $(ISO) isodir

kernel.bin: kernel/main.c kernel/screen.c
	i686-elf-gcc -ffreestanding -m32 -c kernel/main.c -o main.o
	i686-elf-gcc -ffreestanding -m32 -c kernel/screen.c -o screen.o
	i686-elf-ld -T linker.ld -o kernel.bin -nostdlib main.o screen.o

clean:
	rm -rf *.o *.bin isodir $(ISO)
```

---

### 5. üîó Linker Script: `linker.ld`

```ld
ENTRY(kernel_main)

SECTIONS {
    . = 0x100000;
    .text : {
        *(.text)
    }
    .data : {
        *(.data)
    }
    .bss : {
        *(.bss COMMON)
    }
}
```

---

## üß™ –ó–∞–ø—É—Å–∫ –≤ QEMU

```bash
make
qemu-system-i386 -cdrom myos.iso
```

---

## üß© –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ: –ú–æ–¥—É–ª–∏ —Ç–≤–æ–µ–≥–æ —è–¥—Ä–∞

–¢—ã –º–æ–∂–µ—à—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ—é –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (–∫–∞–∫ –≤ Linux):

```c
typedef struct KernelModule {
    const char *name;
    void (*init)();
    void (*shutdown)();
} KernelModule;
```

–ü—Ä–∏–º–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥—É–ª—è:

```c
void register_module(KernelModule *mod) {
    print("–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è: ");
    print(mod->name);
    print("\n");
    mod->init();
}
```

---

## üìò –†–µ—Å—É—Ä—Å—ã

* [osdev.org](https://wiki.osdev.org) ‚Äî —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –û–°
* [Writing a Simple Kernel](https://github.com/cfenollosa/os-tutorial)
* [GRUB Multiboot Spec](https://www.gnu.org/software/grub/manual/multiboot/)
* [Book: Operating Systems: From 0 to 1](https://github.com/tuhdo/os01)

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –º–æ–¥—É–ª—è:

* –¢—ã —Å–æ–±—Ä–∞–ª —Å–≤–æ—ë —è–¥—Ä–æ —Å –≤—ã–≤–æ–¥–æ–º –Ω–∞ —ç–∫—Ä–∞–Ω;
* –ó–Ω–∞–µ—à—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç boot ‚Üí kernel\_main();
* –ì–æ—Ç–æ–≤ —Ä–∞—Å—à–∏—Ä—è—Ç—å —è–¥—Ä–æ: –≤–≤–æ–¥, –ø–∞–º—è—Ç—å, —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞, –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å;
* –£–º–µ–µ—à—å —Å—Ç—Ä–æ–∏—Ç—å –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏.
