# üêß –ú–û–î–£–õ–¨ 4: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —è–¥—Ä–∞ Linux ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã

---

## üéØ –¶–µ–ª—å –º–æ–¥—É–ª—è:

* –ò–∑—É—á–∏—Ç—å, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ —è–¥—Ä–æ Linux: –∫–∞–∫–∏–µ —É –Ω–µ–≥–æ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã, —Å–ª–æ–∏ –∏ –º–æ–¥—É–ª–∏;
* –ü–æ–Ω—è—Ç—å, –∫–∞–∫ —è–¥—Ä–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è;
* –†–∞–∑–æ–±—Ä–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ —è–¥—Ä–∞;
* –£–≤–∏–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã.

---

## üì¶ –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —è–¥—Ä–∞ Linux

–Ø–¥—Ä–æ Linux ‚Äî —ç—Ç–æ **–º–æ–¥—É–ª—å–Ω–∞—è –º–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω–∞—è –Ω–∞ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã:

### üîß –ü–æ–¥—Å–∏—Å—Ç–µ–º—ã —è–¥—Ä–∞:

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                  |
| ------------------------- | ------------------------------------------- |
| **Process scheduler**     | –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤       |
| **Memory management**     | –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å, –∞–ª–ª–æ–∫–∞—Ç–æ—Ä—ã, –∫—ç—à —Å—Ç—Ä–∞–Ω–∏—Ü |
| **VFS (Virtual FS)**      | –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º                  |
| **Device drivers**        | –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ |
| **Networking**            | TCP/IP —Å—Ç–µ–∫, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è                  |
| **System call interface** | –ú–æ—Å—Ç –º–µ–∂–¥—É user space –∏ kernel space        |
| **Interrupts/IRQ**        | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π             |

---

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ —è–¥—Ä–∞

–í–æ—Ç –æ–±–∑–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏–∑ [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Linux](https://github.com/torvalds/linux):

```
linux/
‚îú‚îÄ‚îÄ arch/         ‚Üê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (x86, arm –∏ –¥—Ä.)
‚îú‚îÄ‚îÄ init/         ‚Üê –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–¥—Ä–∞
‚îú‚îÄ‚îÄ kernel/       ‚Üê –Ø–¥—Ä–æ (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã)
‚îú‚îÄ‚îÄ mm/           ‚Üê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
‚îú‚îÄ‚îÄ fs/           ‚Üê –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
‚îú‚îÄ‚îÄ drivers/      ‚Üê –î—Ä–∞–π–≤–µ—Ä—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îú‚îÄ‚îÄ include/      ‚Üê –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ ipc/          ‚Üê –ú–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
‚îú‚îÄ‚îÄ net/          ‚Üê –°–µ—Ç–µ–≤–∞—è –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞
‚îú‚îÄ‚îÄ block/        ‚Üê –†–∞–±–æ—Ç–∞ —Å –±–ª–æ—á–Ω—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
‚îî‚îÄ‚îÄ Documentation/‚Üê –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## üß™ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–¥—Ä–∞ (—Å—Ç–∞—Ä—Ç —Å–∏—Å—Ç–µ–º—ã)

1. **GRUB** –∏–ª–∏ –¥—Ä—É–≥–æ–π –∑–∞–≥—Ä—É–∑—á–∏–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —è–¥—Ä–æ (`vmlinuz`) –≤ –ø–∞–º—è—Ç—å
2. **–§–∞–π–ª `init/main.c`**, —Ñ—É–Ω–∫—Ü–∏—è `start_kernel()` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞:

### üîç –ü—Ä–∏–º–µ—Ä: `start_kernel()` (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)

```c
asmlinkage void __init start_kernel(void) {
    printk(KERN_INFO "Starting Linux kernel...\n");

    setup_arch(&command_line);   // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π
    setup_command_line(command_line); // –†–∞–∑–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏
    mm_init();                   // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏
    sched_init();                // –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
    rest_init();                 // –ó–∞–ø—É—Å–∫ PID 0 ("idle") –∏ PID 1 ("init")
}
```

---

## üßµ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (Scheduler)

–§–∞–π–ª: `kernel/sched/`

–Ø–¥—Ä–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å —Å –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ–º**. –ü—Ä–æ—Ü–µ—Å—Å—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π `task_struct`:

```c
struct task_struct {
    pid_t pid;
    long state;
    unsigned int flags;
    struct mm_struct *mm;
    ...
};
```

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º—ã CFS (Completely Fair Scheduler).

---

## üß† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

–§–∞–π–ª: `mm/`, `include/linux/mm.h`

* –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å
* –°—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è (4 KB, 2 MB, 1 GB)
* –§–∏–∑–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è —Ä–∞–º–∫–∞ (page frame)
* –ê–ª–ª–æ–∫–∞—Ç–æ—Ä—ã: `buddy`, `slab`, `slub`

–ü—Ä–∏–º–µ—Ä:

```c
void *ptr = kmalloc(1024, GFP_KERNEL); // –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤ —è–¥—Ä–µ
```

---

## üóÇ –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (VFS)

–§–∞–π–ª: `fs/`

–ê–±—Å—Ç—Ä–∞–≥–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –§–°: ext4, btrfs, vfat –∏ —Ç.–¥.

–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

```c
struct file;       // –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
struct inode;      // –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
struct dentry;     // –°–≤—è–∑—å –º–µ–∂–¥—É –∏–º–µ–Ω–µ–º –∏ inode
```

---

## üìû –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã

–§–∞–π–ª: `arch/x86/entry/syscalls/`

–í—Å–µ –≤—ã–∑–æ–≤—ã —Ç–∏–ø–∞ `read()`, `open()`, `execve()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏–∏ —è–¥—Ä–∞ –∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ **—Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ (syscall)**.

–ü—Ä–∏–º–µ—Ä:

```c
SYSCALL_DEFINE1(hello, int, value) {
    printk(KERN_INFO "Hello syscall with value: %d\n", value);
    return value + 1;
}
```

---

## üìé –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –¥—Ä–∞–π–≤–µ—Ä–æ–≤

–§–∞–π–ª: `drivers/`

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –¥—Ä–∞–π–≤–µ—Ä–∞ ‚Äî –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –Ω–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/dev/hello`).

---

## üì∂ –°–µ—Ç–µ–≤–∞—è –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞

–§–∞–π–ª: `net/`

* –°–µ—Ç–µ–≤–∞—è —Å—Ç–µ–∫: IPv4, IPv6, TCP, UDP
* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã: `eth0`, `lo`, `wlan0`
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `socket`, `sk_buff`

---

## üìò –ü—Ä–∞–∫—Ç–∏–∫–∞

1. –°–∫–∞—á–∞–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —è–¥—Ä–∞ Linux:

   ```bash
   git clone https://github.com/torvalds/linux.git
   cd linux
   ```

2. –ù–∞–π–¥–∏ –∏ –æ—Ç–∫—Ä–æ–π:

   * `init/main.c` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
   * `kernel/sched/core.c` ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
   * `fs/open.c` ‚Äî —Ñ–∞–π–ª–æ–≤—ã–µ –≤—ã–∑–æ–≤—ã

3. –ù–∞–π–¥–∏ `task_struct`, `inode`, `kmalloc`, `SYSCALL_DEFINE` –≤ –∫–æ–¥–µ –∏ –∏–∑—É—á–∏ –∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –º–æ–¥—É–ª—è:

* –¢—ã –∑–Ω–∞–µ—à—å, –∏–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ–∏—Ç —è–¥—Ä–æ Linux;
* –ü–æ–Ω–∏–º–∞–µ—à—å –µ–≥–æ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤;
* –£–º–µ–µ—à—å –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω—É–∂–Ω—ã–µ —á–∞—Å—Ç–∏ —è–¥—Ä–∞ –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö –∏ —á–∏—Ç–∞—Ç—å –∏—Ö;
* –ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ **–º–æ–¥—É–ª—è–º —è–¥—Ä–∞ (LKM)** –∏ –ø—Ä–∞–∫—Ç–∏–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è –¥—Ä–∞–π–≤–µ—Ä–æ–≤ (–ú–æ–¥—É–ª—å 5).
